<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <title>Using Swift With Cocoa and Objective-C: Interoperability-Interacting With C APIs - zxhfirefox&#8217;s Blog</title>
    <meta name="author" content="zxhfirefox">


    <meta name="description" content="作为和ObjC互用性的一部分，Swift保留了一部分和C兼容的类型和特性。Swift也提供了一种和通用的C结构和模式的方法。 基础类型 Swift提供了和C一样的基础整数类型。然而，Swift并不提供默认的这些类型和Swift类型的自动转换，所以谨慎使用。 C Type Swift Type &hellip;">


    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link rel="canonical" href="http://zxhfirefox.github.io/blog/2014/11/17/using-swift-with-objc-interoperability-y-interact-with-c">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/atom.xml" rel="alternate" title="zxhfirefox's Blog" type="application/atom+xml">
    <script src="/javascripts/modernizr-2.0.js"></script>

    <script>
    !window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))
    </script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>



    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-55876830-1']);
    _gaq.push(['_trackPageview']);
    _gaq.push(['_setDomainName', 'github.io']);

    (function() {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
    })();
    </script>


</head>

<body>
    <header role="banner">
        <hgroup>
            <h1><a href="/">zxhfirefox&#8217;s Blog</a></h1>

            <h2>A place to record some words.</h2>

        </hgroup>

    </header>
    <nav role="navigation">




        <ul class="main-navigation">
            <li><a href="/">Blog</a>
            </li>
            <li><a href="/blog/archives">Archives</a>
            </li>
            <li><a href="/about">About</a>
            </li>
        </ul>

    </nav>
    <div id="main">
        <div id="content">
            <div>
                <article class="hentry" role="article">

                    <header>

                        <h1 class="entry-title">Using Swift With Cocoa and Objective-C: Interoperability-Interacting With C APIs</h1>


                        <p class="meta">





                            <time class='entry-date' datetime='2014-11-17T23:19:56+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:19 pm</span>
                            </time>

                        </p>


                        <h5>禁止用于商业用途，转载请注明出处</h5>

                    </header>


                    <div class="entry-content">
                        <p>作为和ObjC互用性的一部分，Swift保留了一部分和C兼容的类型和特性。Swift也提供了一种和通用的C结构和模式的方法。</p>

                        <!-- more -->


                        <h3>基础类型</h3>

                        <p>Swift提供了和C一样的基础整数类型。然而，Swift并不提供默认的这些类型和Swift类型的自动转换，所以谨慎使用。</p>

                        <pre><code>C Type              Swift Type
bool                CBool
char,signed char    CChar
unsigned char       CUnsignedChar
short               CShort
unsigned short      CUnsignedShort
int                 CInt
unsigned int        CUnsignedInt
long                CLong
unsigned long       CUnsignedLong
long long           CLongLong
unsigned long long  CUnsignedLongLong
wchar_t             CWideChar
char16_t            CChar16
char32_t            CChar32
float               CFloat
double              CDouble
</code></pre>

                        <h3>枚举</h3>

                        <p>Swift会把所有的使用NS_ENUM的C枚举导入成一个Swift的枚举类型。这意味着枚举值的前缀会被截掉。</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="c1">//ObjC</span>
</span><span class='line'><span class="k">typedef</span> <span class="nf">NS_ENUM</span><span class="p">(</span><span class="bp">NSInteger</span><span class="p">,</span> <span class="n">UITableViewCellStyle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>   <span class="n">UITableViewCellStyleDefault</span><span class="p">,</span>
</span><span class='line'>   <span class="n">UITableViewCellStyleValue1</span><span class="p">,</span>
</span><span class='line'>   <span class="n">UITableViewCellStyleValue2</span><span class="p">,</span>
</span><span class='line'>   <span class="n">UITableViewCellStyleSubtitle</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>到了Swift就变成了：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="c1">//Swift</span>
</span><span class='line'><span class="k">enum</span> <span class="nl">UITableViewCellStyle</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">Default</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">Value1</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">Value2</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">Subtitle</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>当我们引用一个枚举值时，在值的前面加一个 .</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">let</span> <span class="nl">cellStyle</span><span class="p">:</span> <span class="n">UITableViewCellStyle</span> <span class="o">=</span> <span class="p">.</span><span class="n">Default</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>Swift也会导入被标记为NS_OPTIONS的options枚举值。这些枚举的值可以支持位操作符。</p>

                        <p>在ObjC里，我们使用0表示空的option。在Swift里，使用nil。</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">let</span> <span class="n">myString</span> <span class="o">=</span> <span class="n">myData</span><span class="p">.</span><span class="n">base64EncodedStringWithOptions</span><span class="p">(</span><span class="nb">nil</span><span class="p">)</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <h3>指针</h3>

                        <p>在任何时候，Swift都会避免让我们直接访问指针。但是，仍然提供了一些指针类型供我们需要时使用。下面的Type是一个真实类型的占位符。</p>

                        <p>对于返回值，变量，参数，有下面的映射：</p>

                        <pre><code>C Syntax        Swift Syntax
const Type *    UnsafePointer&lt;Type&gt;
Type *          UnsafeMuatblePointer&lt;Type&gt;
</code></pre>

                        <p>对于类类型：</p>

                        <pre><code>C Syntax            Swift Syntax
Type * const *      UnsafePointer&lt;Type&gt;
Type * __strong *   UnsafeMutablePointer&lt;Type&gt;
Type **             AutoreleasingUnsafeMutablePointer&lt;Type&gt;
</code></pre>

                        <h4>常量指针</h4>

                        <p>当一个函数声明如果接受一个UnsafePointer
                            <Type>的参数，它可以接受一下几种： * nil，作为空指针传入 * 一个UnsafePointer
                                <Type>，UnsafeMutablePointer
                                    <Type>，AutoreleasingUnsafeMutablePointer
                                        <Type> 值，并转换到UnsafePointer
                                            <Type>。 * 一个in-out表达式，它的操作数是一个Type的左值。作为操作数的地址传入。 * 一个[Type]值，作为一个数组开始的指针传入，生命周期也是函数调用。</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">func</span> <span class="nf">takesAPointer</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="n">UnsafePointer</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">}</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>我们可以调用：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">var</span> <span class="nl">x</span><span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span class='line'><span class="n">var</span> <span class="nl">p</span><span class="p">:</span> <span class="n">UnsafePointer</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nb">nil</span>
</span><span class='line'><span class="n">takesAPointer</span><span class="p">(</span><span class="nb">nil</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAPointer</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAPointer</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>当一个函数接受一个UnsafePointer
                            <Void>的参数，他可以接受任何的Type在UnsafePointer
                                <Type>里可以接受的参数。</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">func</span> <span class="nf">takesAVoidPointer</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="n">UnsafePointer</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="p">)</span>  <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>我们可以调用：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">var</span> <span class="nl">x</span><span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="n">var</span> <span class="nl">p</span><span class="p">:</span> <span class="n">UnsafePointer</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">,</span> <span class="nl">q</span><span class="p">:</span> <span class="n">UnsafePointer</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nb">nil</span>
</span><span class='line'><span class="n">takesAVoidPointer</span><span class="p">(</span><span class="nb">nil</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAVoidPointer</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAVoidPointer</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAVoidPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAVoidPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">y</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAVoidPointer</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span> <span class="n">as</span> <span class="p">[</span><span class="n">Float</span><span class="p">])</span>
</span><span class='line'><span class="n">let</span> <span class="n">intArray</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span class='line'><span class="n">takesAVoidPointer</span><span class="p">(</span><span class="n">intArray</span><span class="p">)</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <h4>可变指针</h4>

                        <p>当一个函数接受一个UnsafeMutablePointer
                            <Type>的参数时，它可以接受下面的实参： * nil作为空指针传入 * 一个 UnsafeMutablePointer
                                <Type> 值 * 一个in-out表达式，它的操作数是一个Type的左值。作为操作数的地址传入 * 一个[Type]值，作为一个数组开始的指针传入，生命周期也是函数调用</p>

                        <p>例如：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">func</span> <span class="nf">takesAMutablePointer</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="n">UnsafeMutablePointer</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">}</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>下面的调用都可以：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">var</span> <span class="nl">x</span><span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span class='line'><span class="n">var</span> <span class="nl">p</span><span class="p">:</span> <span class="n">UnsafeMutablePointer</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nb">nil</span>
</span><span class='line'><span class="n">var</span> <span class="nl">a</span><span class="p">:</span> <span class="p">[</span><span class="n">Float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
</span><span class='line'><span class="n">takesAMutablePointer</span><span class="p">(</span><span class="nb">nil</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAMutablePointer</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAMutablePointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAMutablePointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>当一个函数接受一个UnsafeMutablePointer
                            <Void>的参数，他可以接受任何的Type在UnsafeMutablePointer
                                <Type>里可以接受的参数。</p>

                        <p>例如：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">func</span> <span class="nf">takesAMutableVoidPointer</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="n">UnsafeMutablePointer</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="p">)</span>  <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>下面的调用都可以：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">var</span> <span class="nl">x</span><span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="n">var</span> <span class="nl">p</span><span class="p">:</span> <span class="n">UnsafeMutablePointer</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">,</span> <span class="nl">q</span><span class="p">:</span> <span class="n">UnsafeMutablePointer</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nb">nil</span>
</span><span class='line'><span class="n">var</span> <span class="nl">a</span><span class="p">:</span> <span class="p">[</span><span class="n">Float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="nl">b</span><span class="p">:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span class='line'><span class="n">takesAMutableVoidPointer</span><span class="p">(</span><span class="nb">nil</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAMutableVoidPointer</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAMutableVoidPointer</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAMutableVoidPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAMutableVoidPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">y</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAMutableVoidPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAMutableVoidPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <h4>自动释放的指针</h4>

                        <p>当一个函数接受一个AutoreleasingUnsafeMutablePointer
                            <Type>的参数时，它可以接受下面的实参： * nil作为空指针传入 * 一个 AutoreleasingUnsafeMutablePointer
                                <Type> 值 * 一个in-out表达式，它的操作数是基础类型被拷贝的临时的非拥有的buffer。这个buffer的地址被传递给被调用函数，然后在返回时，这个buffer的值被加载，保留(retained)，并且赋值给这个操作数</p>

                        <p>注意，没有数组。</p>

                        <p>例如：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">func</span> <span class="nf">takesAnAutoreleasingPointer</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="n">AutoreleasingUnsafeMutablePointer</span><span class="o">&lt;</span><span class="bp">NSDate</span><span class="o">?&gt;</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>下面的调用都可以：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="n">var</span> <span class="nl">x</span><span class="p">:</span> <span class="bp">NSDate</span><span class="o">?</span> <span class="o">=</span> <span class="nb">nil</span>
</span><span class='line'><span class="n">var</span> <span class="nl">p</span><span class="p">:</span> <span class="n">AutoreleasingUnsafeMutablePointer</span><span class="o">&lt;</span><span class="bp">NSDate</span><span class="o">?&gt;</span> <span class="o">=</span> <span class="nb">nil</span>
</span><span class='line'><span class="n">takesAnAutoreleasingPointer</span><span class="p">(</span><span class="nb">nil</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAnAutoreleasingPointer</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span class='line'><span class="n">takesAnAutoreleasingPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">)</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>被指向的类型是不会被桥接的。例如，NSString** 转到Swift就成了AutoreleasingUnsafeMutablePointer&lt;NSString?>而不是AutoreleasingUnsafeMutablePointer&lt;String?>。</p>

                        <h4>函数指针</h4>

                        <p>C的函数指针在Swift里成了CFunctionPointer
                            <Type>，而Type是一个Swift函数类型。例如，一个C里的函数指针是 int (*)(void)类型的，转到Swift就变成了CFunctionPointer&lt;() -> Int32>。</p>

                        <h3>全局常量</h3>

                        <p>在C和ObjC定义的全局常量会被自动导入为Swift全局常量。</p>

                        <h3>预编译指令</h3>

                        <p>Swift编译器并不包含预编译器。相反，它使用一些编译期的属性，编译配置和语言特性来完成类似的功能。因此，预编译指令在Swift里并没有被实现。</p>

                        <h4>简单的宏</h4>

                        <p>通常我们在C和ObjC里用#define来定义的宏，在Swift都应该用全局常量代替。例如，#define FADE_ANIMATION_DURATION 0.35 在Swift里表示为let FADE_ANIMATION_DURATION = 0.35 更好。这样简单的宏会被导入为全局常量。</p>

                        <h4>复杂的宏</h4>

                        <p>在C和ObjC里使用的复杂的宏在Swift里没有替代品。复杂的宏是指那些没有定义常量的，包括使用参数的，类似于函数的宏。我们在C和ObjC里使用复杂的宏是为了避免类型检查的限制或者避免大量重复的代码。然而，宏会增加我们bebug和重构的复杂度。在Swift里，我们可以使用函数和泛型来达到同样的目的。因此，在C和ObjC的复杂的宏在Swift里不可用。</p>

                        <h4>编译配置</h4>

                        <p>Swift和ObjC代码通过不同的方式编译。Swift代码可以根据编译配置的值来条件编译。编译配置包含了字面的true和false，命令行flag，还有下面的平台检测函数。我们可以使用-D &lt;#flag#>。</p>

                        <pre><code>函数                  参数
os()                  OS X,iOS
arch()                x86_64,arm,arm64,i386


注意
arch(arm)的结果对于arm64的设备返回是false。arch(i386)对于32位iOS模拟器返回true。
</code></pre>

                        <p>一个简单的条件编译：</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="cp">#if build configuration</span>
</span><span class='line'>    <span class="n">statements</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>    <span class="n">statements</span>
</span><span class='line'><span class="cp">#endif</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>我们也可以使用||，&amp;&amp;，和 ！来写出复杂的条件编译。</p>

                        <figure class='code'>
                            <figcaption><span></span>
                            </figcaption>
                            <div class="highlight">
                                <table>
                                    <tr>
                                        <td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre>
                                        </td>
                                        <td class='code'><pre><code class='objc'><span class='line'><span class="cp">#if build configuration &amp;&amp; !build configuration</span>
</span><span class='line'>    <span class="n">statements</span>
</span><span class='line'><span class="cp">#elseif build configuration</span>
</span><span class='line'>    <span class="n">statements</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>    <span class="n">statements</span>
</span><span class='line'><span class="cp">#endif</span>
</span></code></pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </figure>


                        <p>和C里的条件编译不一样，Swift里条件编译的代码部分必须是完整独立且语法正确的代码块。因为所有的Swift代码都会做语法检查，即使它在条件编译的时候不会编译。</p>
                    </div>


                    <footer>
                        <p class="meta">



                            <span class="byline author vcard">Posted by <span class="fn">zxhfirefox</span></span>






                            <time class='entry-date' datetime='2014-11-17T23:19:56+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:19 pm</span>
                            </time>


                            <span class="categories">
  
    <a class='category' href='/blog/categories/swift/'>swift</a>
  
</span>


                        </p>

                        <div class="sharing">



                        </div>


                        <p class="meta">

                            <a class="basic-alignment left" href="/blog/2014/11/17/using-swift-with-objc-interoperability-y-adopting-cocoa-design-patterns/" title="Previous Post: Using Swift with Cocoa and Objective-C: Interoperability-Adopting Cocoa Design Patterns">&laquo; Using Swift with Cocoa and Objective-C: Interoperability-Adopting Cocoa Design Patterns</a>


                            <a class="basic-alignment right" href="/blog/2014/11/17/using-swift-with-objc-mix-and-match-swift-and-objc-in-same-project/" title="Next Post: Using Swift with Cocoa and Objective-C: Mix and Match-Swift and ObjC in the Same Project">Using Swift with Cocoa and Objective-C: Mix and Match-Swift and ObjC in the Same Project &raquo;</a>

                        </p>
                    </footer>
                </article>

                <section>
                    <h1>Comments</h1>
                    <div id="disqus_thread" aria-live="polite">
                        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
                        </noscript>
                    </div>
                </section>

            </div>

            <aside class="sidebar">

                <section>
                    <h1>Recent Posts</h1>
                    <ul id="recent_posts">

                        <li class="post">
                            <a href="/blog/2014/11/17/using-swift-with-objc-n-migration-migrating-your-objc-code-to-swift/">Using Swift With Cocoa and Objective-C: Migration-Migrating Your ObjC Code to Swift</a>
                        </li>

                        <li class="post">
                            <a href="/blog/2014/11/17/using-swift-with-objc-mix-and-match-swift-and-objc-in-same-project/">Using Swift With Cocoa and Objective-C: Mix and Match-Swift and ObjC in the Same Project</a>
                        </li>

                        <li class="post">
                            <a href="/blog/2014/11/17/using-swift-with-objc-interoperability-y-interact-with-c/">Using Swift With Cocoa and Objective-C: Interoperability-Interacting With C APIs</a>
                        </li>

                        <li class="post">
                            <a href="/blog/2014/11/17/using-swift-with-objc-interoperability-y-adopting-cocoa-design-patterns/">Using Swift With Cocoa and Objective-C: Interoperability-Adopting Cocoa Design Patterns</a>
                        </li>

                        <li class="post">
                            <a href="/blog/2014/11/17/using-swift-with-objc-interoperability-x-working-with-cocoa-data-types/">Using Swift With Cocoa and Objective-C: Interoperability-Working With Cocoa Data Types</a>
                        </li>

                    </ul>
                </section>






            </aside>


        </div>
    </div>
    <footer role="contentinfo">
        <p>
            Copyright &copy; 2015 - zxhfirefox

        </p>

    </footer>










</body>

</html>
